# Basic Messages Application
Simple application that allows users to submit messages, retrieve them, and delete them. A message is a simple object containing content and ID. Moreover, user can ask whether the content of a message is palindrome.

**WARNING:** This application is written as an assignment. The stored messages will be deleted on server restart. There is no user authentication.

*Note:* cURL examples and command line instructions in this documentation are based on Windows.

<br />

Table of Contents
-----------------
[**REST APIs**](#rest)

[**Run Application Locally**](#runlocal)

[**Deployment**](#deploy)

[**Description of Architecture**](#architecture)

[**Usecase Sequence Diagrams**](#sequence)

[**TODO List**](#todo)

[**License**](#license)

<br />

<a name="rest"></a>
## REST APIs
------------
*Note:* The cURL command examples in this section all use *'localhost:3000'* URL based on assumption that you are running the application locally with default settings (explained in [Run Application Locally](#runlocal)). Adjust if this assumption is not correct.

To follow these example, get cURL from: [https://curl.haxx.se/download.html](https://curl.haxx.se/download.html)

<br />

<a name="obj"></a>
### **Message Object**
A message object sent or received to/from APIs contains a content and an id. The JSON representation of a message is as follows:
```json
{
    "messageContent" : "string",
    "messageId" : "string"
}
```
Where:

*"messageContent"* is a string of length more than 0 and less than or equal 255 characters. There is no requirement on having unique message contents.

*"messageId"* is a UUID string.

*"messageId"* is ignored if passed in when creating a new message. It will be generated by the application, not accepted from user.

<br />

<a name="post"></a>
### **Submit a New Message**
Define your message in JSON format as explained in [Message Object](#obj). For example:
```json
{
    "messageContent":"my first message"
}
```
The call to create the message looks like this:
```
curl -i -X POST -H "Content-type: application/json" -d "{\"messageContent\":\"my first message\"}" http://localhost:3000/api/v1/messages
```

Alternatively, if you save the JSON representation in a file named msg.json you may perform following:
```
curl -i -X POST -H "Content-type: application/json" -d @msg.json http://localhost:3000/api/v1/messages
```

Either way, here is a sample response from server upon success:
```json
HTTP/1.1 201 Created

{"messageContent":"my first message","messageId":"6d140eb0-81ba-11e6-baa1-3f31e0b78789"}
```
Take a note of the value of returned *"messageId"* for the rest of operations.

If an error ocurrs, you may see a status code other than 201 with an error object returned in response body. For example, the following response is received if content-type header is not application/json:
```json
HTTP/1.1 415 Unsupported Media Type

{"message":"Content-type must be application/json"}
```
<br />

<a name="getall"></a>
### **Retrieve All Messages**

The call to retrieve all messages looks like this:
```
curl -i -X GET http://localhost:3000/api/v1/messages
```
This is a sample response when there are two messages created so far:
```json
HTTP/1.1 200 OK

[
    {"messageContent":"my first message","messageId":"6d140eb0-81ba-11e6-baa1-3f31e0b78789"},
    {"messageContent":"Madam, I'm Adam","messageId":"d5af3b70-81ba-11e6-9537-35e83f3424bd"}    
]
```

<br />

### **Retrieve a Message**

To retrieve a message, you need its ID which is the value of *"messageId"* property returned as part of response when the message was first created (as in [Submit a New Message](#post)). Alternatively, you may get IDs of all existing message by retrieing all messages (as in [Get All Messages](#getall)).

The API syntax to get a message is:
```
curl -i -X GET http://localhost:3000/api/v1/messages/<messageId>
```

For example, the call to retrieve the message we created as example in [Submit a New Message](#post) looks like this:
```
curl -i -X GET http://localhost:3000/api/v1/messages/6d140eb0-81ba-11e6-baa1-3f31e0b78789
```
And the response is:
```json
HTTP/1.1 200 OK

{"messageContent":"my first message","messageId":"6d140eb0-81ba-11e6-baa1-3f31e0b78789"}
```

If an invalid/nonexisting ID is specified, a **_404 Not Found_** status code and an error message is returned:
```json
HTTP/1.1 404 Not Found

{"code":"EU100","message":"Failed to retreive message(s)"}
```
The *"code":"EU100"* is an error code to be able to troubleshoot easily and narrow down the problem when investigating defects or customer problems.

The list of error codes can be found in [Error Codes](src/server/helpers/errorCodes.js).

<br />

#### **Determine if a Message is a Palindrome**

To determine whether a message is a palindrome, use the following syntax:
```
curl -i -X GET http://localhost:3000/api/v2/messages/<messagId>/palindrome
```
For example, the following are api request and responses to get whether our *"my first message"* is a palindrome:
```
curl -i -X GET http://localhost:3000/api/v2/messages/6d140eb0-81ba-11e6-baa1-3f31e0b78789/palindrome
```
```json
HTTP/1.1 200 OK

{"messageContent":"my first message","messageId":"6d140eb0-81ba-11e6-baa1-3f31e0b78789","isPalindrome":false}
```

An older version of this api (v1) is as follows:

API syntax:
```
curl -i -X GET http://localhost:3000/api/v1/messages/<messagId>/palindrome
```

When the message is a palindrome, this version returns status code of **_204 No Content_**. When the message is not a palindrome, this version returns status code of **_422 Unprocessable Entity_**.


For example, calling this api on message with content *"Madam, I'm Adam"* is as follows:
```
curl -i -X GET http://localhost:3000/api/v1/messages/d5af3b70-81ba-11e6-9537-35e83f3424bd/palindrome
```
```json
HTTP/1.1 204 No Content
```

And, calling this api on message with content *"my first message"* is as follows:
```
curl -i -X GET http://localhost:3000/api/v1/messages/6d140eb0-81ba-11e6-baa1-3f31e0b78789/palindrome
```
```json
HTTP/1.1 422 Unprocessable Entity
```

In both API versions, if an invalid/nonexisting ID is specified, a **_404 Not Found_** status code and an error message is returned:
```json
HTTP/1.1 404 Not Found

{"code":"EU100","message":"Failed to retreive message(s)"}
```


<br />

### **Delete a Message**

To delete a message, you need its ID which is the value of *"messageId"* property returned as part of response when the message was first created (as in [Submit a New Message](#post)). Alternatively, you may get IDs of all existing message by retrieing all messages (as in [Get All Messages](#getall)).

The API syntax to delete a message is:
```
curl -i -X DELETE http://localhost:3000/api/v1/messages/<messageId>
```

For example, the call to delete the message we created as example in [Submit a New Message](#post) looks like this:
```
curl -i -X DELETE http://localhost:3000/api/v1/messages/6d140eb0-81ba-11e6-baa1-3f31e0b78789
```
And the response is:
```json
HTTP/1.1 204 No Content
```

If an invalid/nonexisting ID is specified, a **_404 Not Found_** status code and an error message is returned:
```json
HTTP/1.1 404 Not Found

{"code":"EU100","message":"Failed to retreive message(s)"}
```

<br />

<a name="runlocal"></a>
## Run Application Locally
--------------------------
Follow the instructions in this section to get the project up and running on your local machine for development. 


### **Prerequisities**
* Install NodeJs from: [https://nodejs.org/en/download/](https://nodejs.org/en/download/)
* Create an account in Cloudant: [https://cloudant.com/](https://cloudant.com/)

### **Set Environment Variables**
Open command line and set following environment variables based on your Cloudant account. The database name is anything you want, just stick to Cloudant rules (e.g. only lower case).

Keep this command line open for the rest of instructions, the variables are set only for this session.

```
set DATABASE_NAME=yourdbname
set DATABASE_USER=yourusername
set DATABASE_PASS=yourpass
```
Where *yourdbname*, *yourusername*, *yourpass* are replaced with your own values.

### **Install and Run**
* Change directory to the project folder 
* Run `npm install` - This will download all node packages.
* Run `npm run dev` - This will run the server and will watch any code changes you make.
* Watch the console, it will tell you when server is ready by printing `server listening on port 3000` 
* Execute any of API call examples in [REST APIs](#rest).

<br />

<a name="deploy"></a>
## Deploy to AWS - Elastic Beanstalk
------------------------------------

<br />

<a name="architecture"></a>
## Description of Architecture
------------------------------

### Data Modeling

### API Versioning

<br />

<a name="sequence"></a>
## Usecase Sequence Diagrams
----------------------------

### **Create a message: Interaction of components**
![Image - create message diagram](http://messagingqlik.us-west-2.elasticbeanstalk.com/images/createMessage.png)

<br />

<a name="todo"></a>
## TODO List
------------
[] Support https

[] Authentication

[] User interface

[] Tests

[] Etag

[] Response compression

[] Multitenancy

[] Pagination

[] Swagger

[] Log to file

<br />

<a name="license"></a>
## License
----------
This project is licensed under the MIT License - see [LICENSE.txt](LICENSE.txt).